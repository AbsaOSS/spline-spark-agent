{
  "openapi": "3.0.0",
  "info": {
    "description": "Api Documentation",
    "version": "1.0",
    "title": "Api Documentation",
    "termsOfService": "urn:tos",
    "contact": {},
    "license": {
      "name": "Apache 2.0",
      "url": "http://www.apache.org/licenses/LICENSE-2.0"
    }
  },
  "tags": [
    {
      "name": "execution",
      "description": "Execution Events Controller"
    },
    {
      "name": "status",
      "description": "Status Controller"
    }
  ],
  "paths": {
    "/execution-events": {
      "post": {
        "tags": [
          "execution"
        ],
        "summary": "Save Execution Events",
        "description": "\n        Saves a list of Execution Events.\n\n        Payload format:\n\n        [\n          {\n            // Reference to the execution plan Id that was triggered\n            planId: <UUID>,\n            // Time (milliseconds since Epoch) when the execution finished\n            timestamp: <number>,\n            // [Optional] Additional info about the error (in case there was an error during the execution)\n            error: {...},\n            // Any other extra information related to the given execution event\n            extra: {...}\n          },\n          ...\n        ]\n      ",
        "operationId": "executionEventUsingPOST",
        "requestBody": {
          "content": {
            "application/vnd.absa.spline.producer.v1.1+json": {
              "schema": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/ExecutionEvent"
                }
              }
            }
          },
          "description": "execEvents",
          "required": true
        },
        "responses": {
          "201": {
            "description": "All execution Events are successfully stored",
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/BoxedUnit"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Not Found"
          }
        },
        "deprecated": false
      }
    },
    "/execution-plans": {
      "post": {
        "tags": [
          "execution"
        ],
        "summary": "Save Execution Plan",
        "description": "\n        Saves an Execution Plan and returns its new UUID.\n\n        In most cases, if `id` is provided by the client it will be used and returned\n        to the client. However, in the future Spline server could recognize duplicated\n        execution plans, in which case the method will return UUID of already existing\n        execution plan. In all the future interactions with the Spline API, the client\n        must use this UUID instead of the original UUID to refer the given Execution Plan.\n\n        Payload format:\n\n        {\n          // [Optional] Global unique identifier of the execution plan. If omitted, will be generated by the server.\n          id: <UUID>,\n\n          // Operation level lineage info\n          operations: {\n\n            // Write operation\n            write: {\n              // Operation ID (should be unique in the scope of the current execution plan)\n              id: <string>,\n              // Destination URI, where the data has been written to\n              outputSource: <URI>,\n              // Shows if the write operation appended or replaced the data in the target destination\n              append: <boolean>,\n              // Array of preceding operations IDs,\n              // i.e. operations that serves as an input for the current operation\n              childIds: [<string>],\n              // [Optional] Operation parameters\n              params: {...},\n              // [Optional] Custom info about the operation\n              extra: {...}\n            },\n\n            // Array of read operations\n            reads: [\n              {\n                // Operation ID (see above)\n                id: <string>,\n                // Source URIs, where the data has been read from\n                inputSources: [<URI>],\n                // [Optional] Custom info about the operation\n                params: {...},\n                // [Optional] Custom info about the operation\n                extra: {...}\n              },\n              ...\n            ],\n\n            // Other operations\n            other: [\n              {\n                // Operation ID (see above)\n                id: <string>,\n                // Array of preceding operations IDs (see above)\n                childIds: [<string>],\n                // [Optional] Custom info about the operation\n                params: {...},\n                // [Optional] Custom info about the operation\n                extra: {...}\n              },\n              ...\n            ]\n          },\n\n          // Attribute level lineage info\n          expressions: {\n\n            // Attribute definitions\n            attributes: [\n              {\n                id: <string>,\n                // Attribute name\n                name: <string>,\n                // [Optional] IDs of other expressions (attributes, functions or constants) that this attribute is computed from\n                childIds: [<string>],\n                // [Optional] Custom info\n                extra: {...}\n              }\n            ],\n\n            // Function definitions\n            functions: [\n              {\n                id: <string>,\n                // Function name\n                name: <string>,\n                // [Optional] IDs of child expressions (attributes, functions or constants)\n                childIds: [<string>],\n                // [Optional] Arguments' expression IDs\n                args: [<string>],\n                // [Optional] Named expression parameters\n                params: {...},\n                // [Optional] Custom meta info\n                extra: {...}\n              }\n            ],\n\n            // Constant/Literal definitions\n            constants: {\n              {\n                id: <string>,\n                // constant value\n                value: <any>,\n                // [Optional] Custom meta info\n                extra: {...}\n              }\n            },\n\n            // Operation output definitions.\n            // Maps operation IDs to arrays of attribute IDs that form the corresponding operation output.\n            mappingByOperation: {\n              <string>: [<string>],\n            }\n          },\n\n          // Information about the data framework in use (e.g. Spark, StreamSets etc)\n          systemInfo: {\n            name: <string>,\n            version: <string>\n          },\n\n          // [Optional] Spline agent information\n          agentInfo: {\n            name: <string>,\n            version: <string>\n          },\n\n          // [Optional] Any other extra info associated with the current execution plan\n          extraInfo: {...}\n        }\n      ",
        "operationId": "executionPlanUsingPOST",
        "requestBody": {
          "content": {
            "application/vnd.absa.spline.producer.v1.1+json": {
              "schema": {
                "$ref": "#/components/schemas/ExecutionPlan"
              }
            }
          },
          "description": "execPlan",
          "required": true
        },
        "responses": {
          "201": {
            "description": "Execution Plan is stored with the UUID returned in a response body",
            "content": {
              "*/*": {
                "schema": {
                  "type": "string",
                  "format": "uuid"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Not Found"
          }
        },
        "deprecated": false
      }
    },
    "/status": {
      "head": {
        "tags": [
          "status"
        ],
        "summary": "Server health status",
        "description": "Check that producer is running and that the database is accessible and initialized",
        "operationId": "statusHeadUsingHEAD",
        "responses": {
          "200": {
            "description": "Everything's working",
            "content": {
              "*/*": {
                "schema": {
                  "type": "object"
                }
              }
            }
          },
          "204": {
            "description": "No Content"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "503": {
            "description": "There is a problem"
          }
        },
        "deprecated": false
      }
    }
  },
  "servers": [
    {
      "url": "//localhost/"
    }
  ],
  "components": {
    "schemas": {
      "Attribute": {
        "type": "object",
        "required": [
          "childIds",
          "extra",
          "id",
          "name"
        ],
        "properties": {
          "id": {
            "type": "string"
          },
          "dataType": {
            "type": "object"
          },
          "childIds": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "extra": {
            "type": "object",
            "additionalProperties": {
              "type": "object"
            }
          },
          "name": {
            "type": "string"
          }
        },
        "title": "Attribute"
      },
      "BoxedUnit": {
        "type": "object",
        "title": "BoxedUnit"
      },
      "DataOperation": {
        "type": "object",
        "required": [
          "id"
        ],
        "properties": {
          "id": {
            "type": "string"
          },
          "childIds": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "params": {
            "type": "object",
            "additionalProperties": {
              "type": "object"
            }
          },
          "extra": {
            "type": "object",
            "additionalProperties": {
              "type": "object"
            }
          }
        },
        "title": "DataOperation"
      },
      "ExecutionEvent": {
        "type": "object",
        "required": [
          "planId",
          "timestamp"
        ],
        "properties": {
          "planId": {
            "type": "string",
            "format": "uuid"
          },
          "timestamp": {
            "type": "integer",
            "format": "int64"
          },
          "error": {
            "type": "object"
          },
          "extra": {
            "type": "object",
            "additionalProperties": {
              "type": "object"
            }
          }
        },
        "title": "ExecutionEvent"
      },
      "ExecutionPlan": {
        "type": "object",
        "required": [
          "operations",
          "systemInfo"
        ],
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "operations": {
            "$ref": "#/components/schemas/Operations"
          },
          "expressions": {
            "$ref": "#/components/schemas/Expressions"
          },
          "systemInfo": {
            "$ref": "#/components/schemas/NameAndVersion"
          },
          "agentInfo": {
            "$ref": "#/components/schemas/NameAndVersion"
          },
          "extraInfo": {
            "type": "object",
            "additionalProperties": {
              "type": "object"
            }
          }
        },
        "title": "ExecutionPlan"
      },
      "Expressions": {
        "type": "object",
        "required": [
          "attributes",
          "constants",
          "functions",
          "mappingByOperation"
        ],
        "properties": {
          "attributes": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Attribute"
            }
          },
          "functions": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/FunctionalExpression"
            }
          },
          "constants": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Literal"
            }
          },
          "mappingByOperation": {
            "type": "object",
            "additionalProperties": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "title": "Expressions"
      },
      "FunctionalExpression": {
        "type": "object",
        "required": [
          "args",
          "childIds",
          "extra",
          "id",
          "name",
          "params"
        ],
        "properties": {
          "id": {
            "type": "string"
          },
          "dataType": {
            "type": "object"
          },
          "childIds": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "extra": {
            "type": "object",
            "additionalProperties": {
              "type": "object"
            }
          },
          "name": {
            "type": "string"
          },
          "args": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "params": {
            "type": "object",
            "additionalProperties": {
              "type": "object"
            }
          }
        },
        "title": "FunctionalExpression"
      },
      "Literal": {
        "type": "object",
        "required": [
          "extra",
          "id",
          "value"
        ],
        "properties": {
          "id": {
            "type": "string"
          },
          "dataType": {
            "type": "object"
          },
          "extra": {
            "type": "object",
            "additionalProperties": {
              "type": "object"
            }
          },
          "value": {
            "type": "object"
          }
        },
        "title": "Literal"
      },
      "NameAndVersion": {
        "type": "object",
        "required": [
          "name",
          "version"
        ],
        "properties": {
          "name": {
            "type": "string"
          },
          "version": {
            "type": "string"
          }
        },
        "title": "NameAndVersion"
      },
      "Operations": {
        "type": "object",
        "required": [
          "write"
        ],
        "properties": {
          "write": {
            "$ref": "#/components/schemas/WriteOperation"
          },
          "reads": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ReadOperation"
            }
          },
          "other": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/DataOperation"
            }
          }
        },
        "title": "Operations"
      },
      "ReadOperation": {
        "type": "object",
        "required": [
          "childIds",
          "id",
          "inputSources"
        ],
        "properties": {
          "childIds": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "inputSources": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "id": {
            "type": "string"
          },
          "params": {
            "type": "object",
            "additionalProperties": {
              "type": "object"
            }
          },
          "extra": {
            "type": "object",
            "additionalProperties": {
              "type": "object"
            }
          }
        },
        "title": "ReadOperation"
      },
      "WriteOperation": {
        "type": "object",
        "required": [
          "append",
          "childIds",
          "id",
          "outputSource"
        ],
        "properties": {
          "outputSource": {
            "type": "string"
          },
          "append": {
            "type": "boolean"
          },
          "id": {
            "type": "string"
          },
          "childIds": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "params": {
            "type": "object",
            "additionalProperties": {
              "type": "object"
            }
          },
          "extra": {
            "type": "object",
            "additionalProperties": {
              "type": "object"
            }
          }
        },
        "title": "WriteOperation"
      }
    }
  }
}
